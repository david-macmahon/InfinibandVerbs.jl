<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>InfinibandVerbs.jl Documentation ¬∑ InfinibandVerbs.jl</title><meta name="title" content="InfinibandVerbs.jl Documentation ¬∑ InfinibandVerbs.jl"/><meta property="og:title" content="InfinibandVerbs.jl Documentation ¬∑ InfinibandVerbs.jl"/><meta property="twitter:title" content="InfinibandVerbs.jl Documentation ¬∑ InfinibandVerbs.jl"/><meta name="description" content="Documentation for InfinibandVerbs.jl."/><meta property="og:description" content="Documentation for InfinibandVerbs.jl."/><meta property="twitter:description" content="Documentation for InfinibandVerbs.jl."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>InfinibandVerbs.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>InfinibandVerbs.jl Documentation</a><ul class="internal"><li><a class="tocitem" href="#General-functions"><span>General functions</span></a></li><li><a class="tocitem" href="#Send-related-functions"><span>Send related functions</span></a></li><li><a class="tocitem" href="#Receive-related-functions"><span>Receive related functions</span></a></li><li><a class="tocitem" href="#Lesser-directly-used-functions"><span>Lesser directly-used functions</span></a></li><li><a class="tocitem" href="#Index"><span>Index</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>InfinibandVerbs.jl Documentation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>InfinibandVerbs.jl Documentation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/david-macmahon/InfinibandVerbs.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands">ÔÇõ</span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid">ÔÅÑ</span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="InfinibandVerbs.jl-Documentation"><a class="docs-heading-anchor" href="#InfinibandVerbs.jl-Documentation">InfinibandVerbs.jl Documentation</a><a id="InfinibandVerbs.jl-Documentation-1"></a><a class="docs-heading-anchor-permalink" href="#InfinibandVerbs.jl-Documentation" title="Permalink"></a></h1><div class="admonition is-warning" id="Under-construction-ad3c3d9951e678ca"><header class="admonition-header">üöß üë∑ Under construction üë∑ üöß<a class="admonition-anchor" href="#Under-construction-ad3c3d9951e678ca" title="Permalink"></a></header><div class="admonition-body"><p>This documenation is under construction.</p></div></div><p>Here are some of the more commonly used high level API functions.  They are presented in these sections:</p><ul><li><a href="#InfinibandVerbs.jl-Documentation">InfinibandVerbs.jl Documentation</a></li><li class="no-marker"><ul><li><a href="#General-functions">General functions</a></li><li><a href="#Send-related-functions">Send related functions</a></li><li><a href="#Receive-related-functions">Receive related functions</a></li><li><a href="#Lesser-directly-used-functions">Lesser directly-used functions</a></li><li><a href="#Index">Index</a></li></ul></li></ul><h2 id="General-functions"><a class="docs-heading-anchor" href="#General-functions">General functions</a><a id="General-functions-1"></a><a class="docs-heading-anchor-permalink" href="#General-functions" title="Permalink"></a></h2><p>These structure and functions are useful for both sending and receiving packets.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.Context" href="#InfinibandVerbs.Context"><code>InfinibandVerbs.Context</code></a> ‚Äî <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Context(dev_name, port_num; &lt;kwargs&gt;)</code></pre><p>Create a <code>Context</code> object to use Infiniband Verbs on <code>port_num</code> of <code>dev_name</code>.</p><p>Keyword arguments, described in the extended help, control various aspects of the created objects.  Their default values request minimal resources, but non-trivial applications will need to request more resources depending on the application&#39;s needs.  Upon successful return, the <code>Context</code>&#39;s queue pair will be in the <code>IBV_QPS_INIT</code> state.</p><p><strong>Extended help</strong></p><p>The <code>Context</code> structure manages the following fields (so you don&#39;t have to):</p><table><tr><th style="text-align: left">Field name</th><th style="text-align: left">Type</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>context</code></td><td style="text-align: left"><code>Ptr{ibv_context}</code></td><td style="text-align: left">Context from C library</td></tr><tr><td style="text-align: left"><code>pd</code></td><td style="text-align: left"><code>Ptr{ibv_pd}</code></td><td style="text-align: left">Protection domain</td></tr><tr><td style="text-align: left"><code>send_comp_channel</code></td><td style="text-align: left"><code>Ptr{ibv_comp_channel}</code></td><td style="text-align: left">Send completion channel</td></tr><tr><td style="text-align: left"><code>recv_comp_channel</code></td><td style="text-align: left"><code>Ptr{ibv_comp_channel}</code></td><td style="text-align: left">Receive completion channel</td></tr><tr><td style="text-align: left"><code>send_cq</code></td><td style="text-align: left"><code>Ptr{ibv_cq}</code></td><td style="text-align: left">Send completion queue</td></tr><tr><td style="text-align: left"><code>recv_cq</code></td><td style="text-align: left"><code>Ptr{ibv_cq}</code></td><td style="text-align: left">Receive completion queue</td></tr><tr><td style="text-align: left"><code>qp</code></td><td style="text-align: left"><code>Ptr{ibv_qp}</code></td><td style="text-align: left">Queue pair</td></tr><tr><td style="text-align: left"><code>send_wcs</code></td><td style="text-align: left"><code>Vector{ibv_wc}</code></td><td style="text-align: left">Send work completions</td></tr><tr><td style="text-align: left"><code>recv_wcs</code></td><td style="text-align: left"><code>Vector{ibv_wc}</code></td><td style="text-align: left">Recv work completions</td></tr></table><p>The following fields of the <code>Context</code> structure hold sizing information:</p><table><tr><th style="text-align: left">Field name</th><th style="text-align: left">Type</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>send_cqe</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Number of send completion queue events</td></tr><tr><td style="text-align: left"><code>recv_cqe</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Number of recv completion queue events</td></tr><tr><td style="text-align: left"><code>max_send_wr</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Max number of posted send work requests</td></tr><tr><td style="text-align: left"><code>max_recv_wr</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Max number of posted recv work requests</td></tr><tr><td style="text-align: left"><code>max_send_sge</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Max number of SGEs per send work request</td></tr><tr><td style="text-align: left"><code>max_recv_sge</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Max number of SGEs per recv work request</td></tr><tr><td style="text-align: left">(!) <code>max_inline_data</code></td><td style="text-align: left"><code>UInt32</code></td><td style="text-align: left">Maximum amount of inline data</td></tr></table><p>The <code>Context</code> constructor supports the following keyword arguments:</p><table><tr><th style="text-align: left">Keyword argument</th><th style="text-align: center">Default</th><th style="text-align: left">Description</th></tr><tr><td style="text-align: left"><code>force</code></td><td style="text-align: center"><code>false</code></td><td style="text-align: left">Allow <code>dev_name:port_num</code> to be inactive</td></tr><tr><td style="text-align: left">(-) <code>send_cqe</code></td><td style="text-align: center"><code>1</code></td><td style="text-align: left">Number of events for send completion queue</td></tr><tr><td style="text-align: left">(-) <code>recv_cqe</code></td><td style="text-align: center"><code>1</code></td><td style="text-align: left">Number of events for recv completion queue</td></tr><tr><td style="text-align: left">(-) <code>max_send_wr</code></td><td style="text-align: center"><code>1</code></td><td style="text-align: left">Maximum number of send work requests</td></tr><tr><td style="text-align: left">(-) <code>max_recv_wr</code></td><td style="text-align: center"><code>1</code></td><td style="text-align: left">Maximum number of recv work requests</td></tr><tr><td style="text-align: left">(-) <code>max_send_sge</code></td><td style="text-align: center"><code>1</code></td><td style="text-align: left">Maximum number of SGEs for send WR sg_lists</td></tr><tr><td style="text-align: left">(-) <code>max_recv_sge</code></td><td style="text-align: center"><code>1</code></td><td style="text-align: left">Maximum number of SGEs for recv WR sg_lists</td></tr><tr><td style="text-align: left"><code>req_notify_send</code></td><td style="text-align: center"><code>true</code></td><td style="text-align: left">Request send CQ notifications</td></tr><tr><td style="text-align: left"><code>req_notify_recv</code></td><td style="text-align: center"><code>true</code></td><td style="text-align: left">Request recv CQ notifications</td></tr><tr><td style="text-align: left"><code>solicited_only_send</code></td><td style="text-align: center"><code>false</code></td><td style="text-align: left"><code>solicited_only</code> for send CQ notifications</td></tr><tr><td style="text-align: left"><code>solicited_only_recv</code></td><td style="text-align: center"><code>false</code></td><td style="text-align: left"><code>solicited_only</code> for recv CQ notifications</td></tr><tr><td style="text-align: left">(!) <code>comp_vector</code></td><td style="text-align: center"><code>0</code></td><td style="text-align: left">Completion queue <code>comp_vector</code></td></tr><tr><td style="text-align: left">(!) <code>max_inline_data</code></td><td style="text-align: center"><code>0</code></td><td style="text-align: left">Maximum inline data for QP</td></tr><tr><td style="text-align: left">(!) <code>qp_type</code></td><td style="text-align: center"><code>IBV_QPT_RAW_PACKET</code></td><td style="text-align: left">QP type</td></tr></table><div class="admonition is-info" id="Info-57746fc53542137c"><header class="admonition-header">Info<a class="admonition-anchor" href="#Info-57746fc53542137c" title="Permalink"></a></header><div class="admonition-body"><p>Keyword arguments marked with (-) can be passed as <code>-1</code> to use the device&#39;s maximum supported value, which can be retrieved from the <code>Context</code> field of the same name once constructed.  The actual values will be greater than or equal to the requested values.</p></div></div><div class="admonition is-warning" id="Warning-30de6c2c5696b555"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-30de6c2c5696b555" title="Permalink"></a></header><div class="admonition-body"><p>Fields and keyword arguments marked with (!) are for expert use.  Use and/or change at your own risk.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/context.jl#L28-L97">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.hascapability" href="#InfinibandVerbs.hascapability"><code>InfinibandVerbs.hascapability</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">hascapability(ctx::Context, cap)</code></pre><p>Return <code>true</code> if the device corresponding to <code>ctx</code> has capability <code>cap</code>.</p><p><code>cap</code> may be any one (and only one) of the <code>ibv_device_cap_flags</code> or <code>ibv_raw_packet_caps</code> flags.</p><p><strong>Extended help</strong></p><table><tr><th style="text-align: left"><code>ibv_device_cap_flags</code></th></tr><tr><td style="text-align: left"><code>IBV_DEVICE_RESIZE_MAX_WR</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_BAD_PKEY_CNTR</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_BAD_QKEY_CNTR</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_RAW_MULTI</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_AUTO_PATH_MIG</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_CHANGE_PHY_PORT</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_UD_AV_PORT_ENFORCE</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_CURR_QP_STATE_MOD</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_SHUTDOWN_PORT</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_INIT_TYPE</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_PORT_ACTIVE_EVENT</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_SYS_IMAGE_GUID</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_RC_RNR_NAK_GEN</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_SRQ_RESIZE</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_N_NOTIFY_CQ</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_MEM_WINDOW</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_UD_IP_CSUM</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_XRC</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_MEM_MGT_EXTENSIONS</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_MEM_WINDOW_TYPE_2A</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_MEM_WINDOW_TYPE_2B</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_RC_IP_CSUM</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_RAW_IP_CSUM</code></td></tr><tr><td style="text-align: left"><code>IBV_DEVICE_MANAGED_FLOW_STEERING</code></td></tr></table><table><tr><th style="text-align: left"><code>ibv_raw_packet_caps</code></th></tr><tr><td style="text-align: left"><code>IBV_RAW_PACKET_CAP_CVLAN_STRIPPING</code></td></tr><tr><td style="text-align: left"><code>IBV_RAW_PACKET_CAP_SCATTER_FCS</code></td></tr><tr><td style="text-align: left"><code>IBV_RAW_PACKET_CAP_IP_CSUM</code></td></tr><tr><td style="text-align: left"><code>IBV_RAW_PACKET_CAP_DELAY_DROP</code></td></tr></table></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/context.jl#L478-L521">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.post_wrs" href="#InfinibandVerbs.post_wrs"><code>InfinibandVerbs.post_wrs</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">post_wrs(ctx::Context, wr::Ptr; modify_qp=false) -&gt; nothing
post_wrs(ctx::Context, wrs::Vector, idx=1; modify_qp=false) -&gt; nothing</code></pre><p>Post linked WRs to the <code>Context</code>&#39;s QP.</p><p><code>wr</code> may be a <code>Ptr{ibv_send_wr}</code>/<code>Ptr{ibv_recv_wr}</code> or <code>Vector{ibv_send_wr}</code>/<code>Vector{ibv_recv_wr}</code>.  Passing a <code>Vector</code> will only post the WRs that are part of the linked list headed by the WR <code>wrs[idx]</code> of the Vector, which may not be the same as <code>wrs[idx:end]</code>.  Throws a <code>SystemError</code> if the underlying library call fails, otherwise returns <code>nothing</code>.</p><p>If <code>modify_qp</code> is <code>true</code>, the Context&#39;s QP will be transitioned appropriately for the work request type:</p><ul><li><p>For <code>ibv_recv_wr</code>, the QP will be transitioned to a &quot;ready-to-receive&quot; compatible state <em>after</em> posting the WRs.</p></li><li><p>For <code>ibv_send_wr</code>, the QP will be transitioned to the &quot;ready-to-send&quot; state <em>before</em> posting the WRs.</p></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/memory.jl#L228-L248">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.repost_loop" href="#InfinibandVerbs.repost_loop"><code>InfinibandVerbs.repost_loop</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">repost_loop(callback, ctx::Context, wrs, timeout_ms, callback_args...)</code></pre><p>Run a loop that processes work completions and reposts work requests.</p><p>The <code>callback</code> argument is a user supplied callback function described in detail below.  <code>ctx</code> is a <code>Context</code> struct.  <code>wrs</code> is a <code>Vector{ibv_recv_wr}</code> or <code>Vector{ibv_send_wr}</code> containing all the work requests being used. <code>callback_args...</code> are user supplied arguments that will be passed to the user supplied callback function.  Typically <code>callback_args</code> will include the packet buffers (or some other means of getting packet (fragment) buffers) and a <code>Ref{Int}</code> for accumulating the number of packets posted (useful when finding the next location in the packet buffers to use), but the caller is free to decide how to make use of <code>callback_args...</code>.</p><p>The user supplied callback function <code>callback</code> is called for every work completion event that has a non-zero number of work completions.  It is also called if no work completions are received for <code>timeout_ms</code> milliseconds.  The callback function is passed the following arguments:</p><pre><code class="nohighlight hljs">callback(wcs, num_wc, wrs, callback_args...)</code></pre><ul><li><code>wcs</code>: A <code>Vector{ibv_wc}</code> containing work completions (WCs)</li><li><code>num_wc</code>: Number of valid entries in <code>wcs</code> (i.e. <code>wcs[1:num_wc]</code> are valid). If the callback function is called after a timeout, <code>num_wc</code> will be <code>0</code>.</li><li><code>wrs</code>: The same <code>recv_wrs</code> or <code>send_wrs</code> passed to <code>repost_loop</code></li><li><code>callback_args...</code>: The same <code>callback_args...</code> parameters that were passed to <code>repost_loop</code> (the callback function may specify the individual extra arguments by name rather than splatting <code>callback_args</code>)</li></ul><div class="admonition is-warning" id="Warning-11744d7b4b740379"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-11744d7b4b740379" title="Permalink"></a></header><div class="admonition-body"><p>This function can block waiting for work completion events.  It should be run in a separate thread from the main Julia thread so that it will not interfere with the Julia scheduler.  Usually this will be done using <code>Threads.@spawn</code>.  For example (using <code>repost_loop</code> to receive):</p><pre><code class="nohighlight hljs">recvtask = Threads.@spawn repost_loop(recv_callback, ctx, recv_wrs, timeout, user1, user2)</code></pre><p>Note that <code>Threads.@spawn</code> does not create new threads.  To use multiple threads, Julia must be started with more than one thread (e.g. <code>julia -t 4</code>).  Additional threads cannot be created after startup.</p></div></div><p><strong>Extended help</strong></p><p>The main purpose of the callback function is to update the SG lists of the completed work requests (WRs) with pointers to the next available packet (fragment) buffer location(s).  The callback function should return the number of work requests for <code>repost_loop</code> to repost.  Returning <code>0</code> from the callback will keep <code>repost_loop</code> running but no WRs will be reposted.  Returning a negative value will cause <code>repost_loop</code> to return (i.e. end).  When <code>num_wc</code> is <code>0</code> (i.e. after a timeout), the callback should return a value less than <code>0</code> to end the loop or <code>0</code> to keep waiting for more work completions (i.e. packets).</p><p>For streaming applications that run &quot;forever&quot;, the callback function should update the SG lists of the WRs for all <code>num_wc</code> WCs and return <code>num_wc</code>.</p><p>Applications that want to process exactly <code>N</code> WRs should pass <code>N</code> as part of <code>callback_args...</code> as well as two <code>Ref{Int}</code> parameters so the callback function can accumulate the number of WRs posted and the number of WRs done/processed. As the number of WRs posted approaches <code>N</code> the callback may return a number less than than <code>num_wc</code>.  Such applications should also pay attention to the number of done/processed WRs and return a negative value when it equals <code>N</code> (or exceeds <code>N</code>, but that should never happen if exactly <code>N</code> WRs are posted).</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/repostloop.jl#L1-L65">source</a></section></article><h2 id="Send-related-functions"><a class="docs-heading-anchor" href="#Send-related-functions">Send related functions</a><a id="Send-related-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Send-related-functions" title="Permalink"></a></h2><p>These functions are useful when sending packets.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.create_send_wrs" href="#InfinibandVerbs.create_send_wrs"><code>InfinibandVerbs.create_send_wrs</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_send_wrs(ctx::Context, bufs, num_wr[, npad]; offload=false, post=false) -&gt; send_wrs, sges, mrs
create_send_wrs(mrs, bufs, num_wr[, npad]) -&gt; send_wrs, sges</code></pre><p>Return <code>num_wr</code> <code>ibv_send_wr</code> work requests (WRs) and their associated scatter-gather (SG) lists.</p><p><code>bufs</code> and <code>mrs</code>, if given, must be Vectors.  If the form with <code>ctx::Context</code> is called, the memory region(s) of <code>bufs</code> will be registered before calling the <code>mrs</code> form and the resulting MRs will be returned in addition to the WRs and SG lists.  If memory regions <code>mrs</code> are given, their <code>lkey</code> values will be used when populating the SG lists so <code>mrs</code> must correspond to <code>bufs</code>.  All of the Arrays in <code>bufs</code> must hold the same number of packets (i.e. packet fragments).  See the doc string for <a href="#InfinibandVerbs.create_sges"><code>create_sges</code></a> for details about the <code>npad</code> parameter.</p><p>The <code>Context</code> form also accepts keyword arguments <code>offload</code> and <code>post</code>, both of which default to <code>false</code>.  If <code>offload</code> is <code>true</code> the WRs will be setup to offload the IP checksum calculation to the NIC.  You can use <code>hascapability</code> to check whether your device supports this.  See the man page of <code>ibv_post_send</code> for more details.  If <code>post</code> is <code>true</code>, the <code>Context</code>&#39;s QP will be transitioned to the &quot;ready-to-send&quot; (RTS) state and the work requests will be posted.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/memory.jl#L147-L168">source</a></section></article><h2 id="Receive-related-functions"><a class="docs-heading-anchor" href="#Receive-related-functions">Receive related functions</a><a id="Receive-related-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Receive-related-functions" title="Permalink"></a></h2><p>These functions are useful when receiving packets.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.create_recv_wrs" href="#InfinibandVerbs.create_recv_wrs"><code>InfinibandVerbs.create_recv_wrs</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_recv_wrs(ctx::Context, bufs, num_wr[, npad]; post=false) -&gt; recv_wrs, sges, mrs
create_recv_wrs(mrs, bufs, num_wr[, npad]) -&gt; recv_wrs, sges</code></pre><p>Return <code>num_wr</code> <code>ibv_recv_wr</code> work requests (WRs) and their associated scatter-gather (SG) lists.</p><p><code>bufs</code> and <code>mrs</code>, if given, must be Vectors.  If the form with <code>ctx::Context</code> is called, the memory region(s) of <code>bufs</code> will be registered before calling the <code>mrs</code> form and the resulting MRs will be returned in addition to the WRs and SG lists.  If memory regions <code>mrs</code> are given, their <code>lkey</code> values will be used when populating the SG lists so <code>mrs</code> must correspond to <code>bufs</code>.  All of the Arrays in <code>bufs</code> must hold the same number of packets (i.e. packet fragments).  See the doc string for <a href="#InfinibandVerbs.create_sges"><code>create_sges</code></a> for details about the <code>npad</code> parameter.</p><p>The <code>Context</code> form also accepts keyword argument <code>post</code> (default <code>false</code>).  If <code>post</code> is <code>true</code>, the work requests will be posted and the <code>Context</code>&#39;s QP will be transitioned to a &quot;ready-to-receive&quot; (RTR) compatible state.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/memory.jl#L80-L98">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.create_flow" href="#InfinibandVerbs.create_flow"><code>InfinibandVerbs.create_flow</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_flow(qp, port_num; &lt;kwargs&gt;) -&gt; Ptr{ibv_flow}
create_flow(ctx::Context; &lt;kwargs&gt;) -&gt; Ptr{ibv_flow}</code></pre><p>Create a flow rule to specify which packets to receive.</p><p>The flow rule will be created for queue pair <code>qp</code>, port number <code>port_num</code> (or <code>ctx.qp</code> and <code>ctx.port_num</code>).</p><p>Various attributes and selectors of the flow rule can be specified by keyword arguments as described in the extended help.  The returned <code>Ptr{ibv_flow}</code> can be passed to <code>ibv_destroy_flow</code> to remove the flow rule.</p><p><strong>Extended help</strong></p><p><strong>Attributes</strong></p><p>These keyword arguments set general attributes of the flow rule.  See the Linux manual page for <code>ibv_create_flow</code> for more details.</p><ul><li>General flow rule attributes:<ul><li><code>flow_type</code> one of <code>:normal</code> (default), <code>:all</code>, <code>:mc</code>, or <code>:sniffer</code></li><li><code>priority</code> defaults to 0</li><li><code>flow_flags</code> defaults to 0</li></ul></li></ul><p><strong>Selectors</strong></p><p>Keyword arguments that are unspecified (or zero) are not used for matching. Integer values will be converted to network byte order as necessary.</p><ul><li>Ethernet layer selectors<ul><li><code>dmac::NTuple{6, UInt8}</code>: destination MAC address to match</li><li><code>smac::NTuple{6, UInt8}</code>: source MAC address to match</li><li><code>ethtype</code>: EtherType value to match (e.g. <code>0x0800</code> for IPv4 packets)</li><li><code>vlan</code>: VLAN tag to match</li></ul></li><li>IPv4 layer selectors (can be <code>UInt32</code> or <code>IPv4</code>)<ul><li><code>sip</code>: source IPv4 address (e.g. <code>0x0a000123</code> or <code>ip&quot;10.0.1.35&quot;</code>)</li><li><code>dip</code>: destination IPv4 address</li><li><code>proto</code>: IP protocol</li><li><code>tos</code>: Type of service (aka DSCP/ECN)</li><li><code>ttl</code>: Time to live</li><li><code>flags</code>: IP flags</li></ul></li><li>TCP/UDP layer selectors<ul><li><code>dport</code>: destination TCP/UDP port to match</li><li><code>sport</code>: source TCP/UDP port to match</li><li><code>tcpudp</code>: one of <code>:udp</code> (default) or <code>:tcp</code>.  Specifies whether <code>sport</code>/<code>dport</code> should match UDP or TCP ports.  To match all UDP or all TCP packets, use the IPv4 layer <code>proto</code> selector instead.</li></ul></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/flow.jl#L119-L162">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.destroy_flow" href="#InfinibandVerbs.destroy_flow"><code>InfinibandVerbs.destroy_flow</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">destroy_flow(flow) -&gt; nothing</code></pre><p>Destroy <code>flow</code> that was created by <code>create_flow</code>.  Packets specified by <code>flow</code> will no longer be received from the flow&#39;s device and port.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/flow.jl#L200-L205">source</a></section></article><h2 id="Lesser-directly-used-functions"><a class="docs-heading-anchor" href="#Lesser-directly-used-functions">Lesser directly-used functions</a><a id="Lesser-directly-used-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Lesser-directly-used-functions" title="Permalink"></a></h2><p>These functions see less direct use because they are called by more commonly used functions, but sometimes the more commonly used functions expose parameters that are passed on to these functions.</p><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="InfinibandVerbs.create_sges" href="#InfinibandVerbs.create_sges"><code>InfinibandVerbs.create_sges</code></a> ‚Äî <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">create_sges(bufs, lkeys, num_wr[, npad]) -&gt; Matrix{ibv_sge}</code></pre><p>Return a <code>Matrix{ibv_sge}</code> of size <code>(length(bufs), num_wr)</code>.</p><p>Each column of the returned Matrix is an SG list initialized to point to the first <code>num_wr</code> packets of <code>bufs</code>.  Both <code>bufs</code> and <code>lkeys</code> must be Vectors of the same length.  The elements of <code>bufs</code> are Arrays that must be sized for the same number of packets and <code>num_wr</code> must not exceed this number.  The elements of <code>lkeys</code> must be the <code>lkey</code> values corresponding to the registered memory regions for <code>bufs</code>.</p><p>The Arrays in <code>bufs</code> may include a number of padding bytes along their first dimension to improve alignment of the packet data.  The number of padding bytes may be specified by passing <code>npad</code>.  <code>npad</code> may be a single <code>Int</code> to apply the same value to all <code>bufs</code> Arrays or a <code>Vector{Int}</code> to specify values for all the <code>bufs</code> Array.  The default value of <code>npad</code> is <code>0</code> (i.e. no padding).  The value(s) of <code>npad</code> will be subtracted from the number of bytes in the first dimensions of the <code>bufs</code> Array.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/david-macmahon/InfinibandVerbs.jl/blob/228b18da4edd0b2496d8ab2b8ea789b4aa8e5c2a/src/memory.jl#L28-L47">source</a></section></article><h2 id="Index"><a class="docs-heading-anchor" href="#Index">Index</a><a id="Index-1"></a><a class="docs-heading-anchor-permalink" href="#Index" title="Permalink"></a></h2><ul><li><a href="#InfinibandVerbs.Context"><code>InfinibandVerbs.Context</code></a></li><li><a href="#InfinibandVerbs.create_flow"><code>InfinibandVerbs.create_flow</code></a></li><li><a href="#InfinibandVerbs.create_recv_wrs"><code>InfinibandVerbs.create_recv_wrs</code></a></li><li><a href="#InfinibandVerbs.create_send_wrs"><code>InfinibandVerbs.create_send_wrs</code></a></li><li><a href="#InfinibandVerbs.create_sges"><code>InfinibandVerbs.create_sges</code></a></li><li><a href="#InfinibandVerbs.destroy_flow"><code>InfinibandVerbs.destroy_flow</code></a></li><li><a href="#InfinibandVerbs.hascapability"><code>InfinibandVerbs.hascapability</code></a></li><li><a href="#InfinibandVerbs.post_wrs"><code>InfinibandVerbs.post_wrs</code></a></li><li><a href="#InfinibandVerbs.repost_loop"><code>InfinibandVerbs.repost_loop</code></a></li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 21 August 2025 04:27">Thursday 21 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
